@model IEnumerable<Privont.Models.LeadInfo>

@{
    ViewBag.Title = "Lead Info";
    Layout = "~/Views/Shared/_Layout.cshtml";
    System.Data.DataTable dt = new System.Data.DataTable();
    System.Data.DataTable dt2 = new System.Data.DataTable();
    decimal i = 0;
}
<style>
    .theme-primary .select2-container--default.select2-container--open {
        z-index: 9999;
    }

    .progress {
        display: flex;
        height: 2rem;
        overflow: hidden;
        font-size: 0.75rem;
        background-color: #e9ecef;
        border-radius: 0.25rem;
    }
</style>
<div class="content-wrapper">
    <div class="container-full">
        <!-- Content Header (Page header) -->
        <!-- Leads Main content -->
        <section class="content">
            <div class="row">
                <div class="box">
                    <div class="box-header with-border">
                        <h3 class="box-title">Leads</h3>
                        <button type="button" class="btn btn-success btn-sm pull-right" onclick="window.location.href='/LeadInfo/Create'">
                            New
                        </button>
                        <button type="button" class="btn btn-info btn-sm pull-right" data-bs-toggle="modal" data-bs-target="#modal-fill" style="margin:.0 5px;">
                            Upload Leads
                        </button>
                        <button type="button" class="btn btn-primary btn-sm pull-right" data-bs-toggle="modal" data-bs-target="#modal-fill-api" style="margin:.0 5px;">
                            Sync Leads (APIs)
                        </button>
                        @*<button type="button" class="btn btn-primary btn-sm pull-right" onclick="OpenModal()" style="margin:.0 5px;">
                                OpenModal
                            </button>*@
                    </div>
                    <h4 class="text-danger">@ViewBag.Message</h4>
                    <!-- /.box-header -->
                    <div class="box-body">
                        <div class="table-responsive">
                            <table id="example" class="table b-1 table-hover display nowrap margin-top-10 w-p100 border-succes">
                                <thead class="bg-primary">
                                    <tr>
                                        <th>
                                            Name
                                        </th>

                                        <th>
                                            Phone No
                                        </th>
                                        <th>
                                            Email
                                        </th>
                                        @if (General.UserType == 3)
                                        {
                                            <th>
                                                Zip Code
                                            </th>
                                            <th>
                                                Claimed
                                            </th>
                                        }

                                        @if (General.UserType == 2)
                                        {
                                            <td>Price Point</td>
                                            <td>Send SMS</td>
                                            <td>Action</td>
                                        }
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.Where(u => u.SMSSent == false))
                                    {
                                        <tr id="@item.LeadID" onclick="window.location.href='/LeadInfo/GetLeadDetails?LeadID=@item.LeadID'">
                                            <td>
                                                @item.FirstName @item.LastName
                                            </td>
                                            <td>
                                                @item.PhoneNo
                                            </td>
                                            <td>
                                                @item.EmailAddress
                                            </td>
                                            @if (General.UserType == 3)
                                            {
                                                <td>
                                                    @item.ZipCode
                                                </td>
                                                <td>
                                                    @if (item.Claimed == "0")
                                                    {<button id="btn_@item.LeadID" onclick="ClaimLead(@item.LeadID)" type="button" class="m-1 btn btn-danger  btn-sm me-1">
                                                            Claim Lead
                                                        </button>
                                                        <p id="lbl_@item.LeadID" style="display:none">Claimed</p>
                                                    }
                                                    else
                                                    {
                                                        <span>Claimed</span>
                                                    }
                                                </td>

                                            }
                                            @if (General.UserType == 2)
                                            {
                                                <td>
                                                    @if (item.PricePointID == 0)
                                                    {
                                                        <button type="button" class="btn btn-primary btn-sm pull-right" data-bs-toggle="modal" data-bs-target="#modal-fill-PricePoint" id="btn_@item.LeadID" onclick="OpenPricePointModal(@item.LeadID)" style="margin:0 5px;">
                                                            Price Point
                                                        </button>
                                                        <span id="PricePointNametd"></span>
                                                    }
                                                    else
                                                    {
                                                        @item.PricePointName
                                                    }
                                                </td>
                                            }
                                            @if (General.UserType == 2)
                                            {
                                                <td>
                                                    @if (item.isClaimLead == 0)
                                                    {
                                                        if (item.SMSSent == true)
                                                        {
                                                            <p>SMS send</p>
                                                        }
                                                        else
                                                        {
                                                            <button onclick="getClaimingLink(@item.LeadID,'@item.FirstName','@item.LastName')" id="Claimbtn_@item.LeadID" type="button" class="m-1 btn btn-success btn-sm  me-1">
                                                                Get Claim
                                                            </button>
                                                            <p id="AfterClaim_@item.LeadID"></p>
                                                        }
                                                    }
                                                </td>
                                                <td>
                                                    <button onclick="window.location.href='/LeadInfo/Edit/@item.LeadID'" type="button" class="m-1 btn btn-success btn-sm  me-1">
                                                        <i class="fa fa-edit"></i>
                                                    </button>
                                                    <button id="@item.LeadID" onclick="DeleteButtonclicked(this)" type="button" class="m-1 btn btn-danger  btn-sm me-1">
                                                        <i class="fa fa-close"></i>
                                                    </button>
                                                </td>

                                            }
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- /.box-body -->
                </div>

                <!-- /.col -->
            </div>
            <!-- /.row -->
        </section>
        <!-- /.content -->
        <!-- Pending Leads Main content -->
        @if (General.UserType == 2)
        {
            <section class="content">
                <div class="row">
                    <div class="box">
                        <div class="box-header with-border">
                            <h3 class="box-title">Pending Leads</h3>
                        </div>
                        <h4 class="text-danger">@ViewBag.Message</h4>
                        <!-- /.box-header -->
                        <div class="box-body">
                            <div class="table-responsive">
                                <table id="pendingleads" class="table b-1 table-hover display nowrap margin-top-10 w-p100 border-succes">
                                    <thead class="bg-primary">
                                        <tr>
                                            <th>
                                                Name
                                            </th>

                                            <th>
                                                Phone No
                                            </th>
                                            <th>
                                                Email
                                            </th>
                                            @if (General.UserType == 2)
                                            {
                                                <td>Price Point</td>
                                                <td>SMS Send</td>
                                                <td>Action</td>
                                            }
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.Where(u => u.SMSSent == true))
                                        {
                                            <tr id="@item.LeadID" onclick="window.location.href='/LeadInfo/GetLeadDetails?LeadID=@item.LeadID'">
                                                <td>
                                                    @item.FirstName @item.LastName
                                                </td>
                                                <td>
                                                    @item.PhoneNo
                                                </td>
                                                <td>
                                                    @item.EmailAddress
                                                </td>
                                                @if (General.UserType == 2)
                                                {
                                                    <td>
                                                        @if (item.PricePointID == 0)
                                                        {
                                                            <button type="button" class="btn btn-primary btn-sm pull-right" data-bs-toggle="modal" data-bs-target="#modal-fill-PricePoint" id="btn_@item.LeadID" onclick="OpenPricePointModal(@item.LeadID)" style="margin:0 5px;">
                                                                Price Point
                                                            </button>
                                                            <span id="PricePointNametd"></span>
                                                        }
                                                        else
                                                        {
                                                            @item.PricePointName
                                                        }
                                                    </td>
                                                }
                                                @if (General.UserType == 2)
                                                {
                                                    <td>
                                                        @if (item.SMSSent == true)
                                                        {
                                                            <p>SMS send</p>
                                                        }
                                                    </td>
                                                    <td>
                                                        <button onclick="window.location.href='/LeadInfo/Edit/@item.LeadID'" type="button" class="m-1 btn btn-success btn-sm  me-1">
                                                            <i class="fa fa-edit"></i>
                                                        </button>
                                                        <button id="@item.LeadID" onclick="DeleteButtonclicked(this)" type="button" class="m-1 btn btn-danger  btn-sm me-1">
                                                            <i class="fa fa-close"></i>
                                                        </button>

                                                    </td>

                                                }
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- /.box-body -->
                    </div>

                    <!-- /.col -->
                </div>
                <!-- /.row -->
            </section>
            <!-- /.content -->
            <!-- Pending Leads Main content -->
            <section class="content">
                <div class="row">
                    <div class="box">
                        <div class="box-header with-border">
                            <h3 class="box-title">Approved Leads</h3>
                        </div>
                        <h4 class="text-danger">@ViewBag.Message</h4>
                        <!-- /.box-header -->
                        <div class="box-body">
                            <div class="table-responsive">
                                <table id="Approvedleads" class="table b-1 table-hover display nowrap margin-top-10 w-p100 border-succes">
                                    <thead class="bg-primary">
                                        <tr>
                                            <th>
                                                Name
                                            </th>

                                            <th>
                                                Phone No
                                            </th>
                                            <th>
                                                Email
                                            </th>
                                            @if (General.UserType == 2)
                                            {
                                                <td>Price Point</td>
                                                <td>Action</td>
                                            }
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.Where(u => u.isClaimLead == 1))
                                        {
                                            <tr id="@item.LeadID" onclick="window.location.href='/LeadInfo/GetLeadDetails?LeadID=@item.LeadID'">
                                                <td>
                                                    @item.FirstName @item.LastName
                                                </td>
                                                <td>
                                                    @item.PhoneNo
                                                </td>
                                                <td>
                                                    @item.EmailAddress
                                                </td>
                                                @if (General.UserType == 2)
                                                {
                                                    <td>
                                                        @if (item.PricePointID == 0)
                                                        {
                                                            <button type="button" class="btn btn-primary btn-sm pull-right" data-bs-toggle="modal" data-bs-target="#modal-fill-PricePoint" id="btn_@item.LeadID" onclick="OpenPricePointModal(@item.LeadID)" style="margin:0 5px;">
                                                                Price Point
                                                            </button>
                                                            <span id="PricePointNametd"></span>
                                                        }
                                                        else
                                                        {
                                                            @item.PricePointName
                                                        }
                                                    </td>
                                                }
                                                @if (General.UserType == 2)
                                                {
                                                    <td>
                                                        <button onclick="window.location.href='/LeadInfo/GetLeadDetails?LeadID=@item.LeadID'" type="button" class="m-1 btn btn-success btn-sm  me-1">
                                                            <i class="fa fa-eye"></i>
                                                        </button>
                                                        <button onclick="window.location.href='/LeadInfo/Edit/@item.LeadID'" type="button" class="m-1 btn btn-success btn-sm  me-1">
                                                            <i class="fa fa-edit"></i>
                                                        </button>
                                                        <button id="@item.LeadID" onclick="DeleteButtonclicked(this)" type="button" class="m-1 btn btn-danger  btn-sm me-1">
                                                            <i class="fa fa-close"></i>
                                                        </button>
                                                    </td>
                                                }
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- /.box-body -->
                    </div>

                    <!-- /.col -->
                </div>
                <!-- /.row -->
            </section>
            <!-- /.content -->
        }
    </div>
</div>

<div class="modal modal-fill fade" data-backdrop="false" id="modal-fill-PricePoint" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Price Point</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <div class="pull-center">
                                @Html.Label("Price Point", htmlAttributes: new { @class = "form-label" })<span class="text-danger">*</span>
                                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal-fill-NewPricePoint" style="padding: 0px 5px;">
                                    <i class="fa fa-plus"></i>
                                </button>
                                @Html.Hidden("LeadID");
                                @Html.DropDownList("PricePoint", (SelectList)ViewBag.PricePoint, "Select Price Point", htmlAttributes: new { @class = "form-control select2", required = "required", style = "width:100%;" })
                                @Html.ValidationMessage("PricePoint", "", new { @class = "text-danger" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer pull-right">
                    <button type="button" class="btn btn-danger float-end" data-bs-dismiss="modal">Close</button>
                    <input type="button" onclick="LeadPricePoint()" value="Upload Lead" class="btn btn-primary" />
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal center-modal fade" data-backdrop="false" id="modal-fill-api" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h5 class="modal-title">Sync Lead</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body modal-lg">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <div class="pull-center">
                                @Html.Label("Source", htmlAttributes: new { @class = "form-label" })<span class="text-danger">*</span>
                                @Html.DropDownList("ApiLeadID", (SelectList)ViewBag.ApiLeadType, htmlAttributes: new { @class = "form-control select2", required = "required", style = "width:100%;" })
                                @Html.ValidationMessage("ApiLeadID", "", new { @class = "text-danger" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer pull-right">
                    <input type="button" onclick="SyncApiData()" value="Sync Lead" class="btn btn-primary pull-right" />

                    <button type="button" class="btn btn-danger pull-right" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-fill fade" data-backdrop="false" id="modal-fill-NewPricePoint" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Price Point</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="form-label">Price Point</label>
                            <input type="text" class="form-control" id="PricePointName">
                            <span class="text-danger" style="display:none" id="organizationwarning">Please enter Price Point Name</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary float-end" onclick="PricePointSave()">Save changes</button>

                <button type="button" class="btn btn-danger float-end" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal modal-fill fade" data-backdrop="false" id="modal-fill" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Upload Leads</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            @using (Html.BeginForm("UploadLeadFile", "LeadInfo", FormMethod.Post, new { enctype = "multipart/form-data" }))
            {
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <div class="pull-center">
                                    @Html.TextBox("file", "", new { type = "file", accept = ".csv" })
                                    <br />
                                    <br />
                                    <a class="btn btn-success" href="~/SampleFiles/Lead/Lead.csv">Sample</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer pull-right">
                        <button type="button" class="btn btn-danger float-end" data-bs-dismiss="modal">Close</button>
                        <input type="submit" value="Upload Lead" class="btn btn-primary" />
                    </div>
                </div>
            }
        </div>
    </div>
</div>
<div class="modal center-modal fade" data-backdrop="false" id="modalProgressBar" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content modal-lg">
            <div class="modal-body modal-lg">
                <br />
                <div class="row">
                    <div class="col-md-12">
                        <div class="progress">
                            <div class="progress-bar progress-bar-primary progress-bar-striped" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                                <span id="ProgressbarCount" style="font-size:medium">Loading Please Wait!</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /.modal -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>

<script>
    function OpenPricePointModal(obj) {
        var value = obj;
        $("#LeadID").val(value);
    }


    function getClaimingLink(obj,Firstname,LastName) {
        Swal.fire({
            title: 'Are you sure?',
            text: "To Send Message To : " + Firstname + " " + LastName,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes',
            cancelButtonText: 'NO',
        }).then((result) => {
            if (result.isConfirmed) {
        $.ajax({
            url:'/GeneralApis/Encrypt',
            type: 'POST',
            dataType: 'json',
            async: false,
            data: { obj },
            success: function (r) {
                var data = r.split(',');
                var domainUrl = window.location.protocol + "//" + window.location.host;
                const secretKey = 'Privont@Privont';
            const dataToEncrypt = {
                userId: @General.UserID,
                username: 'Abdullah',
                };
            const dataToEncrypt2 = {
                userId: @General.UserID,
                username: 'Abdullah',
            };
                const jsonData = JSON.stringify(dataToEncrypt);
                const jsonData2 = JSON.stringify(dataToEncrypt2);
                const encryptedData = CryptoJS.AES.encrypt(jsonData, secretKey).toString();
                const encryptedData2 = CryptoJS.AES.encrypt(jsonData2, secretKey).toString();
                const token = encryptedData;
                const token2 = encryptedData2;
                var GeneratedLink = domainUrl + "/GeneralApis/Lead?" + 'q=' + token + '&d=' + @General.UserType + '&i=' +@General.UserID+ '&y=' + data[1] + '&s=' + token2;
                sendSMSLink(obj, GeneratedLink);
            }
        });
            }
        })
    }

    function sendSMSLink(obj, GeneratedLink) {
        $.ajax({
            url: '/SMSSetting/SendSms',
            type: 'POST',
            dataType: 'json',
            data: { LeadID: obj, Link: GeneratedLink },
            success: function (r) {
                var data = r.split(',');
                if (data[0] == "true") {
                    SendSMS(data[1], data[2], obj);
                    /*                    alert(data[1]);*/
                }
                else if (data[0] == "1") {
                    Swal.fire(
                        '',
                        'Your SMS Setting is not set please Set this First',
                        'error'
                    );
                    window.location.href = '/SMSSetting/Index';
                }
            },
            error: function () {
                alert('error');
            }
        });
    }

    function SendSMS(message, PhoneNo, obj) {
        /*alert("Working" + message);*/
        $.ajax({
            url: '/SMSTrueDialog/SendPushCampaignAsync',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ PhoneNo: PhoneNo, message: message }),
            success: function (r) {
                var data = r.split(',');
                if (data[0] == "true") {
                    Swal.fire(
                        '',
                        'Sms SuccessFully Send To Lead',
                        'success'
                    );
                    $.ajax({
                    url: '/LeadInfo/UpdateSmsInfo',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({ obj }),
                        success: function (r) {
                            return;
                        }
                    });
                    $("#Claimbtn_" + obj).hide();
                    $("#AfterClaim_" + obj).text("SMS Send");
                }
                else {
                    Swal.fire(
                        '',
                        'Sms Not Send To Lead',
                        'false'
                    );
                }
            }
        });
    }
    //function sendSMS(message, PhoneNo,obj) {
    //    var apiKey = "2a3026c04aef4826ab6bd59af941d29f";
    //    var apiSecret = "Ex5?9Y&ti7T{";
    //    var authHeader = btoa(apiKey + ":" + apiSecret);
    //    var data = {
    //        PhoneNumber: PhoneNo,
    //        Message: message
    //    };
    //    $.ajax({
    //        url: "https://api.truedialog.com/api/v1/sms",
    //        type: "POST",
    //        headers: {
    //            "Authorization": "Basic " + authHeader
    //        },
    //        contentType: "application/json",
    //        data: JSON.stringify(data),
    //        success: function (response) {
    //            // Handle the success response from the TrueDialog API
    //            console.log("Message sent successfully!", response);
    //            $("#Claimbtn_" + obj).hide();
    //        },
    //        error: function (xhr, textStatus, errorThrown) {
    //            // Handle any errors that occur during the AJAX request
    //            console.error("Error sending message:", textStatus, errorThrown);
    //        }
    //    });
    //}

    function ClaimLead(object) {
        jQuery.ajax({
            url: '/LeadInfo/ClaimLead',
            type: 'POST',
            dataType: 'json',
            data: { LeadID: object, LenderID:@General.UserID },
            success: function (r) {
                var data = r.split(',');
                Swal.fire(
                    'Claim',
                    'You Claim This Lead SuccessFully',
                    'success'
                );


                @*< p id="lbl_@item.LeadID" style="display:none" > Already Claimed</p >*@
                if (data[1] == 1) {
                    //alert("Working" + $('table tbody tr td button#' + object.id));
                    //$('button#' + object.id).remove();
                }
                if (data[2] == 1) {
                    Swal.fire(
                        'Claim',
                        'You Cannot Claim This Lead Because its Already Claimed',
                        'danger'
                    );
                }
                if (data[3] == 1) {
                    Swal.fire(
                        'Claim',
                        'You Already Claim this Lead',
                        'danger'
                    );
                }
                $("#lbl_" + object).show();
                $("#btn_" + object).hide();
            },
            error: function () {
                alert('error');
            }
        });
    }

    function LeadPricePoint() {
        var PricePoint = $("#PricePoint").val();
        var PricePointname = $("#PricePoint option:selected").text();
        var LeadID =  $("#LeadID").val();
        $.ajax({
            type: "POST",
            url: "/LeadInfo/LeadPricePoint",
            data: JSON.stringify({ LeadID,PricePoint }),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (r) {
                var data = r.split(',');
                if (data[1] == 1) {
                    Swal.fire("", "Price Point Already Added", "error");
                }
                else {
                    $("#PricePointNametd").text(PricePointname);
                    $("#btn_" + LeadID).hide();
                    $('#modal-fill-PricePoint').modal('hide');
                }
            },
            error: function (x, e) {
                Swal.fire("", "Saving Error");
            },
            async: false
        });
    }

    function PricePointSave(objectre) {
        var PricePoint = $("#PricePointName").val();
        if (PricePoint == "") {
            $("#organizationwarning").show();
            return;
        }
        $("#organizationwarning").hide();
        $.ajax({
            type: "POST",
            url: "/LeadInfo/CreateLeadPricePoint",
            data: JSON.stringify({ PricePoint }),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (r) {
                var catid = r;
                $('#PricePoint').append('<option value="' + r + '">' + PricePoint + '</option>');
                $('#PricePoint').val(r);
                $("#PricePointName").val("");
                $('#modal-fill-NewPricePoint').modal('hide');
            },
            error: function (x, e) {
                Swal.fire("", "Saving Error");
            },
            async: false
        });
    }

    function DeleteButtonclicked(object) {
        Swal.fire({
            title: 'Are you sure?',
            text: "Are you sure to delete the selected record?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Delete'
        }).then((result) => {
            if (result.isConfirmed) {
                jQuery.ajax({
                    url: '/LeadInfo/Delete',
                    type: 'POST',
                    dataType: 'json',
                    data: { id: object.id },
                    success: function () {

                        $("#" + object.id).remove();
                    },
                    error: function () {
                        alert('error');
                    }
                })
                Swal.fire(
                    'Deleted!',
                    'Your record has been deleted.',
                    'success'
                )
            }
        })
    }
    let isThreadRunning = false;
    $(document).ready(function () {
        $('#modalProgressBar').modal({ backdrop: 'static', keyboard: false })
    });
    function SyncInformation() {
        var ApiSource = $("ApiLeadID").val();
        $.ajax({
            type: "POST",
            url: "GetInfoSync",
            data: JSON.stringify({ ApiSource }),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (r) {
                console.log(r);
                $("#ProgressbarCount").text(r+"%");
            },
            error: function (x, e) {
                Swal.fire("", "Progress");
            },
            async: false
        });

    }

    function OpenModal() {
        $("#modalProgressBar").modal('show');
    }
    function SyncApiData() {
        var SourceID = $("#ApiLeadID").val();
        setTimeout(function () {
            $("#modalProgressBar").modal('show');
            $("#modal-fill-api").modal('hide');
        }, 50);
        $.ajax({
            url: 'GetSourceOfAPILeadIndex',
            type: 'POST',
            dataType: 'json',
            async: true,
            data: { UserID: @General.UserID,SourceID },
            success: function (r) {
                var data = r.split(',');
                if (data[0] == "true") {
                    swal.fire("Success", "Syncing Data", "Success");
                    window.location.reload();
                } else {
                    Swal.fire("", "Config Not Found Against This Source Please Add Config", "error");
                    window.location.href = '/RealEstateAgentInfo/APIConfiguration';
                    return;
                }
            }
        });
    }
</script>



